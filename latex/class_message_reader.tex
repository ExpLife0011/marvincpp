\hypertarget{class_message_reader}{}\section{Message\+Reader Class Reference}
\label{class_message_reader}\index{Message\+Reader@{Message\+Reader}}
Inheritance diagram for Message\+Reader\+:\begin{figure}[H]
\begin{center}
\leavevmode
\includegraphics[height=3.000000cm]{class_message_reader}
\end{center}
\end{figure}
\subsection*{Public Member Functions}
\begin{DoxyCompactItemize}
\item 
\mbox{\Hypertarget{class_message_reader_a782500be6ba3210d3afc1cec4c68bd62}\label{class_message_reader_a782500be6ba3210d3afc1cec4c68bd62}} 
{\bfseries Message\+Reader} (boost\+::asio\+::io\+\_\+service \&io, Read\+Socket\+Interface\+S\+Ptr read\+Sock)
\item 
\hyperlink{class_message_reader_ab5a1832a8447dd11d8d57d8aed44d3a9}{$\sim$\+Message\+Reader} ()
\item 
void \hyperlink{class_message_reader_ab63fcdf1b67d82ce259d1e82775149a5}{read\+Headers} (std\+::function$<$ void(Marvin\+::\+Error\+Type err)$>$ cb)
\item 
void \hyperlink{class_message_reader_a811c0c6620e4bc7af99d5f519552846f}{read\+Body} (std\+::function$<$ void(Marvin\+::\+Error\+Type err, \hyperlink{class_buffer_chain}{Buffer\+Chain} chunk)$>$)
\item 
void \hyperlink{class_message_reader_a16e0cec435a29862c95cdccf61b3099b}{read\+Message} (std\+::function$<$ void(Marvin\+::\+Error\+Type err)$>$ cb)
\item 
\hyperlink{class_buffer_chain}{Buffer\+Chain} \hyperlink{class_message_reader_ac480fcf3e6f5b1bb89b467d372a4e435}{get\+\_\+body\+\_\+chain} ()
\item 
\hyperlink{class_buffer_chain}{Buffer\+Chain} \hyperlink{class_message_reader_a93a38a06b77aea962b76fab6f9ba77e2}{get\+\_\+raw\+\_\+body\+\_\+chain} ()
\end{DoxyCompactItemize}
\subsection*{Static Public Member Functions}
\begin{DoxyCompactItemize}
\item 
static void \hyperlink{class_message_reader_ab80bdac9cbb3d446a6d8b5e944ba3bfe}{config\+Set\+\_\+\+Header\+Buffer\+Size} (long bsize)
\item 
static void \hyperlink{class_message_reader_a83e245590821f3c60de01f698febac25}{config\+Set\+\_\+\+Body\+Buffer\+Size} (long bsize)
\end{DoxyCompactItemize}
\subsection*{Protected Member Functions}
\begin{DoxyCompactItemize}
\item 
void \hyperlink{class_message_reader_a9109576c1fd18d70e9187744164c390c}{read\+\_\+headers} (std\+::function$<$ void(Marvin\+::\+Error\+Type err)$>$ cb)
\item 
void \hyperlink{class_message_reader_a71a8b0ca7cc3aab28ee5fd9353f1b843}{read\+\_\+message} (std\+::function$<$ void(Marvin\+::\+Error\+Type err)$>$ cb)
\item 
void \hyperlink{class_message_reader_a73def02a6454f8c90df358790d798718}{\+\_\+read\+\_\+some\+\_\+headers} ()
\item 
void \hyperlink{class_message_reader_a545048a118c1d77940886544742dd9c0}{\+\_\+handle\+\_\+header\+\_\+read} (Marvin\+::\+Error\+Type er, std\+::size\+\_\+t bytes\+\_\+transfered)
\item 
\mbox{\Hypertarget{class_message_reader_a2f4c0d98a480e64f8d769c64f713b5c1}\label{class_message_reader_a2f4c0d98a480e64f8d769c64f713b5c1}} 
void {\bfseries read\+\_\+body} (std\+::function$<$ void(Marvin\+::\+Error\+Type err)$>$ cb)
\item 
void \hyperlink{class_message_reader_a5d38bae22274c77c8bf7b704aef2bccc}{\+\_\+read\+\_\+all\+\_\+body} ()
\item 
void \hyperlink{class_message_reader_acc54adf0f70b46dfcd73d017b1bb422c}{\+\_\+read\+\_\+some\+\_\+body} ()
\item 
void \hyperlink{class_message_reader_a366ff67eab28c15869657c436babf31e}{\+\_\+handle\+\_\+body\+\_\+read} (Marvin\+::\+Error\+Type er, std\+::size\+\_\+t bytes\+\_\+transfered)
\item 
void \hyperlink{class_message_reader_a10d3092b2b3200eaf9b69e49d36d1d69}{\+\_\+read\+\_\+body\+\_\+chunk} ()
\item 
void \hyperlink{class_message_reader_af174bd59d03d7e462f76d137b22863f2}{\+\_\+handle\+\_\+body\+\_\+chunk} (Marvin\+::\+Error\+Type er, std\+::size\+\_\+t bytes\+\_\+transfered)
\item 
void \hyperlink{class_message_reader_a4272b25b74e5b46f37754751da8689c5}{\+\_\+make\+\_\+new\+\_\+body\+\_\+buffer} ()
\item 
void \hyperlink{class_message_reader_a8df7f104650383e80e69a3d212b1e049}{post\+\_\+message\+\_\+cb} (Marvin\+::\+Error\+Type er)
\item 
void \hyperlink{class_message_reader_a82f75653a713d3b947ff3dee82a34d1f}{post\+\_\+body\+\_\+chunk\+\_\+cb} (Marvin\+::\+Error\+Type er, \hyperlink{class_buffer_chain}{Buffer\+Chain} chain)
\item 
bool \hyperlink{class_message_reader_a378b9c5f8136ac24865b5fac3c22694c}{parser\+\_\+ok} (int nparsed, \hyperlink{struct_m_buffer}{M\+Buffer} \&mb)
\item 
\hyperlink{class_message_interface}{Message\+Interface} $\ast$ \hyperlink{class_message_reader_a06ec9e561ff5cde8f4e1ffb0ff17cb1f}{current\+Message} ()
\item 
void \hyperlink{class_message_reader_a813dbc29f75b43f36ef3f770cc39c3e7}{On\+Headers\+Complete} (\hyperlink{class_message_interface}{Message\+Interface} $\ast$msg, void $\ast$body\+\_\+start\+\_\+ptr, std\+::size\+\_\+t remainder)
\item 
\mbox{\Hypertarget{class_message_reader_a5fb4fce3af6faf9ae8460d9d1bbede31}\label{class_message_reader_a5fb4fce3af6faf9ae8460d9d1bbede31}} 
void {\bfseries On\+Message\+Complete} (\hyperlink{class_message_interface}{Message\+Interface} $\ast$msg)
\item 
void \hyperlink{class_message_reader_a4f01917ce0c7c84159f81f797a7d13ec}{On\+Body\+Data} (void $\ast$buf, int len)
\item 
\mbox{\Hypertarget{class_message_reader_a3778ee11c827974e72d5c0e41abba654}\label{class_message_reader_a3778ee11c827974e72d5c0e41abba654}} 
void {\bfseries On\+Chunk\+Begin} (int chunk\+Length)
\item 
\mbox{\Hypertarget{class_message_reader_a193a61f82564385cc94520351c8c9608}\label{class_message_reader_a193a61f82564385cc94520351c8c9608}} 
void {\bfseries On\+Chunk\+Data} (void $\ast$buf, int len)
\item 
\mbox{\Hypertarget{class_message_reader_a3c64d95036ec88f48d87711512e3418c}\label{class_message_reader_a3c64d95036ec88f48d87711512e3418c}} 
void {\bfseries On\+Chunk\+End} ()
\end{DoxyCompactItemize}
\subsection*{Protected Attributes}
\begin{DoxyCompactItemize}
\item 
\mbox{\Hypertarget{class_message_reader_abb038487edc35f1ab52dda94905f12bf}\label{class_message_reader_abb038487edc35f1ab52dda94905f12bf}} 
bool {\bfseries \+\_\+reading\+\_\+full\+\_\+message}
\item 
\mbox{\Hypertarget{class_message_reader_a4f8033980198ae323904b1da61e04018}\label{class_message_reader_a4f8033980198ae323904b1da61e04018}} 
bool {\bfseries \+\_\+reading\+\_\+body}
\item 
\mbox{\Hypertarget{class_message_reader_a163ab2d455cc0309604eba34d98899fd}\label{class_message_reader_a163ab2d455cc0309604eba34d98899fd}} 
std\+::function$<$ void(Marvin\+::\+Error\+Type err)$>$ {\bfseries \+\_\+read\+\_\+message\+\_\+cb}
\item 
\mbox{\Hypertarget{class_message_reader_aafcafdb0a110e408fded627d6adb0437}\label{class_message_reader_aafcafdb0a110e408fded627d6adb0437}} 
std\+::function$<$ void(Marvin\+::\+Error\+Type err, \hyperlink{class_buffer_chain}{Buffer\+Chain} chunk)$>$ {\bfseries \+\_\+read\+\_\+body\+\_\+cb}
\item 
\mbox{\Hypertarget{class_message_reader_a2143042814a1309829b81b6e291c515a}\label{class_message_reader_a2143042814a1309829b81b6e291c515a}} 
int {\bfseries \+\_\+total\+\_\+bytes\+\_\+read}
\item 
\mbox{\Hypertarget{class_message_reader_a98f9607368a080b35b7d30659dfe69fa}\label{class_message_reader_a98f9607368a080b35b7d30659dfe69fa}} 
M\+Buffer\+S\+Ptr {\bfseries \+\_\+header\+\_\+buffer\+\_\+sptr}
\item 
\mbox{\Hypertarget{class_message_reader_a6b71ff33548f957df6c314802af2fcd9}\label{class_message_reader_a6b71ff33548f957df6c314802af2fcd9}} 
M\+Buffer\+S\+Ptr {\bfseries \+\_\+body\+\_\+buffer\+\_\+sptr}
\item 
\mbox{\Hypertarget{class_message_reader_a3411525f143e9e0ed3a072db10734f08}\label{class_message_reader_a3411525f143e9e0ed3a072db10734f08}} 
F\+Buffer\+Shared\+Ptr {\bfseries \+\_\+body\+\_\+fragments\+\_\+sptr}
\item 
\mbox{\Hypertarget{class_message_reader_ad12c7c3612b1bc785b36a3640ac1b859}\label{class_message_reader_ad12c7c3612b1bc785b36a3640ac1b859}} 
\hyperlink{class_buffer_chain}{Buffer\+Chain} {\bfseries \+\_\+raw\+\_\+body\+\_\+buffer\+\_\+chain}
\item 
\mbox{\Hypertarget{class_message_reader_a6e6d5c1c4ab54e7313c68742d0a8d4a7}\label{class_message_reader_a6e6d5c1c4ab54e7313c68742d0a8d4a7}} 
\hyperlink{class_buffer_chain}{Buffer\+Chain} {\bfseries \+\_\+body\+\_\+buffer\+\_\+chain}
\item 
\mbox{\Hypertarget{class_message_reader_aa678e062266320bfb530386be56b9c38}\label{class_message_reader_aa678e062266320bfb530386be56b9c38}} 
std\+::vector$<$ F\+Buffer\+Shared\+Ptr $>$ {\bfseries \+\_\+body\+\_\+fragments\+\_\+chain}
\item 
\mbox{\Hypertarget{class_message_reader_a8c59f3b342647abae8ad4693082fcc31}\label{class_message_reader_a8c59f3b342647abae8ad4693082fcc31}} 
Read\+Socket\+Interface\+S\+Ptr {\bfseries \+\_\+read\+Sock}
\item 
\mbox{\Hypertarget{class_message_reader_af95447697277c9ef993844b57c643591}\label{class_message_reader_af95447697277c9ef993844b57c643591}} 
boost\+::asio\+::io\+\_\+service \& {\bfseries \+\_\+io}
\item 
\mbox{\Hypertarget{class_message_reader_a12621c4803e1dff5d27e237ead132e08}\label{class_message_reader_a12621c4803e1dff5d27e237ead132e08}} 
std\+::size\+\_\+t {\bfseries \+\_\+body\+\_\+buffer\+\_\+size}
\item 
\mbox{\Hypertarget{class_message_reader_a6c2b39003410b82a8fb1fc8807c68bad}\label{class_message_reader_a6c2b39003410b82a8fb1fc8807c68bad}} 
std\+::size\+\_\+t {\bfseries \+\_\+header\+\_\+buffer\+\_\+size}
\item 
\mbox{\Hypertarget{class_message_reader_aa566ebe170a434558fa281037c7535d0}\label{class_message_reader_aa566ebe170a434558fa281037c7535d0}} 
bool {\bfseries \+\_\+read\+Body\+Started}
\item 
\mbox{\Hypertarget{class_message_reader_a39dc9d4c6c5b16c73a55f1f89ed22b16}\label{class_message_reader_a39dc9d4c6c5b16c73a55f1f89ed22b16}} 
\hyperlink{struct_m_buffer}{M\+Buffer} $\ast$ {\bfseries \+\_\+body\+M\+Buffer\+Ptr}
\item 
\mbox{\Hypertarget{class_message_reader_a5e48aeb6d413b756ae8a6a84d830e25d}\label{class_message_reader_a5e48aeb6d413b756ae8a6a84d830e25d}} 
\hyperlink{class_f_buffer}{F\+Buffer} $\ast$ {\bfseries \+\_\+body\+F\+Buffer\+Ptr}
\item 
\mbox{\Hypertarget{class_message_reader_a2ce5dc510e084fa7dc3cc94d5d699277}\label{class_message_reader_a2ce5dc510e084fa7dc3cc94d5d699277}} 
\hyperlink{struct_m_buffer}{M\+Buffer} $\ast$ {\bfseries \+\_\+read\+Buffer}
\item 
\mbox{\Hypertarget{class_message_reader_a47692db94154e8ba7efda892403df476}\label{class_message_reader_a47692db94154e8ba7efda892403df476}} 
std\+::string \hyperlink{class_message_reader_a47692db94154e8ba7efda892403df476}{body}
\begin{DoxyCompactList}\small\item\em used for full message read -\/ body collection \end{DoxyCompactList}\item 
\mbox{\Hypertarget{class_message_reader_a37fd89ff6258ad48b915e625558e1bbc}\label{class_message_reader_a37fd89ff6258ad48b915e625558e1bbc}} 
std\+::ostringstream {\bfseries body\+Stream}
\item 
\mbox{\Hypertarget{class_message_reader_aeb3d223497993154acca83dc6ec9eaa2}\label{class_message_reader_aeb3d223497993154acca83dc6ec9eaa2}} 
Read\+Body\+Data\+Callback\+Type {\bfseries \+\_\+body\+Callback}
\item 
\mbox{\Hypertarget{class_message_reader_a146a65cba204e9aa401484adc230be32}\label{class_message_reader_a146a65cba204e9aa401484adc230be32}} 
Read\+Headers\+Callback\+Type {\bfseries \+\_\+response\+Cb}
\item 
\mbox{\Hypertarget{class_message_reader_a7ad01d613200dec83fb0d0a6a71edb77}\label{class_message_reader_a7ad01d613200dec83fb0d0a6a71edb77}} 
Read\+Message\+Callback\+Type {\bfseries \+\_\+message\+Cb}
\end{DoxyCompactItemize}
\subsection*{Static Protected Attributes}
\begin{DoxyCompactItemize}
\item 
\mbox{\Hypertarget{class_message_reader_a99feadce4d7a038210448aec87a44d90}\label{class_message_reader_a99feadce4d7a038210448aec87a44d90}} 
static std\+::size\+\_\+t {\bfseries \+\_\+\+\_\+header\+Buffer\+Size} = 10000
\item 
\mbox{\Hypertarget{class_message_reader_a7881cc09f4b6f7e45aa21c5a613d7d2c}\label{class_message_reader_a7881cc09f4b6f7e45aa21c5a613d7d2c}} 
static std\+::size\+\_\+t {\bfseries \+\_\+\+\_\+body\+Buffer\+Size} = 20000
\end{DoxyCompactItemize}
\subsection*{Friends}
\begin{DoxyCompactItemize}
\item 
\mbox{\Hypertarget{class_message_reader_a15c731cddafc776dccca9000ad701b43}\label{class_message_reader_a15c731cddafc776dccca9000ad701b43}} 
std\+::string {\bfseries trace\+Reader} (\hyperlink{class_message_reader}{Message\+Reader} \&rdr)
\end{DoxyCompactItemize}


\subsection{Constructor \& Destructor Documentation}
\mbox{\Hypertarget{class_message_reader_ab5a1832a8447dd11d8d57d8aed44d3a9}\label{class_message_reader_ab5a1832a8447dd11d8d57d8aed44d3a9}} 
\index{Message\+Reader@{Message\+Reader}!````~Message\+Reader@{$\sim$\+Message\+Reader}}
\index{````~Message\+Reader@{$\sim$\+Message\+Reader}!Message\+Reader@{Message\+Reader}}
\subsubsection{\texorpdfstring{$\sim$\+Message\+Reader()}{~MessageReader()}}
{\footnotesize\ttfamily Message\+Reader\+::$\sim$\+Message\+Reader (\begin{DoxyParamCaption}{ }\end{DoxyParamCaption})}

Destructor -\/ nothing to do. All pointers held by an instance are smart pointers. 

\subsection{Member Function Documentation}
\mbox{\Hypertarget{class_message_reader_af174bd59d03d7e462f76d137b22863f2}\label{class_message_reader_af174bd59d03d7e462f76d137b22863f2}} 
\index{Message\+Reader@{Message\+Reader}!\+\_\+handle\+\_\+body\+\_\+chunk@{\+\_\+handle\+\_\+body\+\_\+chunk}}
\index{\+\_\+handle\+\_\+body\+\_\+chunk@{\+\_\+handle\+\_\+body\+\_\+chunk}!Message\+Reader@{Message\+Reader}}
\subsubsection{\texorpdfstring{\+\_\+handle\+\_\+body\+\_\+chunk()}{\_handle\_body\_chunk()}}
{\footnotesize\ttfamily void Message\+Reader\+::\+\_\+handle\+\_\+body\+\_\+chunk (\begin{DoxyParamCaption}\item[{Marvin\+::\+Error\+Type}]{er,  }\item[{std\+::size\+\_\+t}]{bytes\+\_\+transfered }\end{DoxyParamCaption})\hspace{0.3cm}{\ttfamily [protected]}}

Completion handler for reading a single chunk of body data. an io error with bytes\+\_\+transfered == 0 is probably E\+OF -\/ let the parser handle it otherwise (err \&\& (bytes\+\_\+transfered $>$ 0)) return with error\mbox{\Hypertarget{class_message_reader_a366ff67eab28c15869657c436babf31e}\label{class_message_reader_a366ff67eab28c15869657c436babf31e}} 
\index{Message\+Reader@{Message\+Reader}!\+\_\+handle\+\_\+body\+\_\+read@{\+\_\+handle\+\_\+body\+\_\+read}}
\index{\+\_\+handle\+\_\+body\+\_\+read@{\+\_\+handle\+\_\+body\+\_\+read}!Message\+Reader@{Message\+Reader}}
\subsubsection{\texorpdfstring{\+\_\+handle\+\_\+body\+\_\+read()}{\_handle\_body\_read()}}
{\footnotesize\ttfamily void Message\+Reader\+::\+\_\+handle\+\_\+body\+\_\+read (\begin{DoxyParamCaption}\item[{Marvin\+::\+Error\+Type}]{er,  }\item[{std\+::size\+\_\+t}]{bytes\+\_\+transfered }\end{DoxyParamCaption})\hspace{0.3cm}{\ttfamily [protected]}}

Step two of the async loop that reads all body data. This is the async completion handler. an io error with bytes\+\_\+transfered == 0 is probably E\+OF -\/ let the parser handle it otherwise (err \&\& (bytes\+\_\+transfered $>$ 0)) return with error\mbox{\Hypertarget{class_message_reader_a545048a118c1d77940886544742dd9c0}\label{class_message_reader_a545048a118c1d77940886544742dd9c0}} 
\index{Message\+Reader@{Message\+Reader}!\+\_\+handle\+\_\+header\+\_\+read@{\+\_\+handle\+\_\+header\+\_\+read}}
\index{\+\_\+handle\+\_\+header\+\_\+read@{\+\_\+handle\+\_\+header\+\_\+read}!Message\+Reader@{Message\+Reader}}
\subsubsection{\texorpdfstring{\+\_\+handle\+\_\+header\+\_\+read()}{\_handle\_header\_read()}}
{\footnotesize\ttfamily void Message\+Reader\+::\+\_\+handle\+\_\+header\+\_\+read (\begin{DoxyParamCaption}\item[{Marvin\+::\+Error\+Type}]{er,  }\item[{std\+::size\+\_\+t}]{bytes\+\_\+transfered }\end{DoxyParamCaption})\hspace{0.3cm}{\ttfamily [protected]}}

Step two in an async loop to read all headers. This is the async completion handler for reading headers Error processing here is a bit tricky
\begin{DoxyItemize}
\item if we are in the middle of processing a messages and we get an io error with bytes\+\_\+transfered == 0, it is probably the other end sending an E\+OF to signal E\+OM so let the parser handle it
\item if this is the first result for a new message and bytes\+\_\+transfered ==0 this is probably the other end signalling socket closed and a new message is not being sent. In this case we dont want the parse to see the E\+OF as it wont treat it as an error and will keep trying to read. want to pass it to the callback as E\+OF
\item otherwise (err \&\& (bytes\+\_\+transfered $>$ 0)) return with error. For testing purposes we have to differentiate between ending a message with E\+OF and signalling connection closed with E\+OF
\end{DoxyItemize}\mbox{\Hypertarget{class_message_reader_a4272b25b74e5b46f37754751da8689c5}\label{class_message_reader_a4272b25b74e5b46f37754751da8689c5}} 
\index{Message\+Reader@{Message\+Reader}!\+\_\+make\+\_\+new\+\_\+body\+\_\+buffer@{\+\_\+make\+\_\+new\+\_\+body\+\_\+buffer}}
\index{\+\_\+make\+\_\+new\+\_\+body\+\_\+buffer@{\+\_\+make\+\_\+new\+\_\+body\+\_\+buffer}!Message\+Reader@{Message\+Reader}}
\subsubsection{\texorpdfstring{\+\_\+make\+\_\+new\+\_\+body\+\_\+buffer()}{\_make\_new\_body\_buffer()}}
{\footnotesize\ttfamily void Message\+Reader\+::\+\_\+make\+\_\+new\+\_\+body\+\_\+buffer (\begin{DoxyParamCaption}{ }\end{DoxyParamCaption})\hspace{0.3cm}{\ttfamily [protected]}}

Creates a shared pointer to a single new buffer for reading body data. \mbox{\Hypertarget{class_message_reader_a5d38bae22274c77c8bf7b704aef2bccc}\label{class_message_reader_a5d38bae22274c77c8bf7b704aef2bccc}} 
\index{Message\+Reader@{Message\+Reader}!\+\_\+read\+\_\+all\+\_\+body@{\+\_\+read\+\_\+all\+\_\+body}}
\index{\+\_\+read\+\_\+all\+\_\+body@{\+\_\+read\+\_\+all\+\_\+body}!Message\+Reader@{Message\+Reader}}
\subsubsection{\texorpdfstring{\+\_\+read\+\_\+all\+\_\+body()}{\_read\_all\_body()}}
{\footnotesize\ttfamily void Message\+Reader\+::\+\_\+read\+\_\+all\+\_\+body (\begin{DoxyParamCaption}{ }\end{DoxyParamCaption})\hspace{0.3cm}{\ttfamily [protected]}}

Kicks off the process of reading all body data. \mbox{\Hypertarget{class_message_reader_a10d3092b2b3200eaf9b69e49d36d1d69}\label{class_message_reader_a10d3092b2b3200eaf9b69e49d36d1d69}} 
\index{Message\+Reader@{Message\+Reader}!\+\_\+read\+\_\+body\+\_\+chunk@{\+\_\+read\+\_\+body\+\_\+chunk}}
\index{\+\_\+read\+\_\+body\+\_\+chunk@{\+\_\+read\+\_\+body\+\_\+chunk}!Message\+Reader@{Message\+Reader}}
\subsubsection{\texorpdfstring{\+\_\+read\+\_\+body\+\_\+chunk()}{\_read\_body\_chunk()}}
{\footnotesize\ttfamily void Message\+Reader\+::\+\_\+read\+\_\+body\+\_\+chunk (\begin{DoxyParamCaption}{ }\end{DoxyParamCaption})\hspace{0.3cm}{\ttfamily [protected]}}

Called by interface method \hyperlink{class_message_reader_a811c0c6620e4bc7af99d5f519552846f}{read\+Body()} Initiates the process of reading O\+NE chunk of body data. Sets up a read and completion handler. No looping for this \mbox{\Hypertarget{class_message_reader_acc54adf0f70b46dfcd73d017b1bb422c}\label{class_message_reader_acc54adf0f70b46dfcd73d017b1bb422c}} 
\index{Message\+Reader@{Message\+Reader}!\+\_\+read\+\_\+some\+\_\+body@{\+\_\+read\+\_\+some\+\_\+body}}
\index{\+\_\+read\+\_\+some\+\_\+body@{\+\_\+read\+\_\+some\+\_\+body}!Message\+Reader@{Message\+Reader}}
\subsubsection{\texorpdfstring{\+\_\+read\+\_\+some\+\_\+body()}{\_read\_some\_body()}}
{\footnotesize\ttfamily void Message\+Reader\+::\+\_\+read\+\_\+some\+\_\+body (\begin{DoxyParamCaption}{ }\end{DoxyParamCaption})\hspace{0.3cm}{\ttfamily [protected]}}

First part of an async loop that reads all body data. This method sets up and initiates an async read \mbox{\Hypertarget{class_message_reader_a73def02a6454f8c90df358790d798718}\label{class_message_reader_a73def02a6454f8c90df358790d798718}} 
\index{Message\+Reader@{Message\+Reader}!\+\_\+read\+\_\+some\+\_\+headers@{\+\_\+read\+\_\+some\+\_\+headers}}
\index{\+\_\+read\+\_\+some\+\_\+headers@{\+\_\+read\+\_\+some\+\_\+headers}!Message\+Reader@{Message\+Reader}}
\subsubsection{\texorpdfstring{\+\_\+read\+\_\+some\+\_\+headers()}{\_read\_some\_headers()}}
{\footnotesize\ttfamily void Message\+Reader\+::\+\_\+read\+\_\+some\+\_\+headers (\begin{DoxyParamCaption}{ }\end{DoxyParamCaption})\hspace{0.3cm}{\ttfamily [protected]}}

The first step in a two part async loop that reads all headers (until headers\+Complete) This function sets up and initiates a read. \mbox{\Hypertarget{class_message_reader_a83e245590821f3c60de01f698febac25}\label{class_message_reader_a83e245590821f3c60de01f698febac25}} 
\index{Message\+Reader@{Message\+Reader}!config\+Set\+\_\+\+Body\+Buffer\+Size@{config\+Set\+\_\+\+Body\+Buffer\+Size}}
\index{config\+Set\+\_\+\+Body\+Buffer\+Size@{config\+Set\+\_\+\+Body\+Buffer\+Size}!Message\+Reader@{Message\+Reader}}
\subsubsection{\texorpdfstring{config\+Set\+\_\+\+Body\+Buffer\+Size()}{configSet\_BodyBufferSize()}}
{\footnotesize\ttfamily void Message\+Reader\+::config\+Set\+\_\+\+Body\+Buffer\+Size (\begin{DoxyParamCaption}\item[{long}]{bsize }\end{DoxyParamCaption})\hspace{0.3cm}{\ttfamily [static]}}

Called at program startup to override the default value for the body buffer \mbox{\Hypertarget{class_message_reader_ab80bdac9cbb3d446a6d8b5e944ba3bfe}\label{class_message_reader_ab80bdac9cbb3d446a6d8b5e944ba3bfe}} 
\index{Message\+Reader@{Message\+Reader}!config\+Set\+\_\+\+Header\+Buffer\+Size@{config\+Set\+\_\+\+Header\+Buffer\+Size}}
\index{config\+Set\+\_\+\+Header\+Buffer\+Size@{config\+Set\+\_\+\+Header\+Buffer\+Size}!Message\+Reader@{Message\+Reader}}
\subsubsection{\texorpdfstring{config\+Set\+\_\+\+Header\+Buffer\+Size()}{configSet\_HeaderBufferSize()}}
{\footnotesize\ttfamily void Message\+Reader\+::config\+Set\+\_\+\+Header\+Buffer\+Size (\begin{DoxyParamCaption}\item[{long}]{bsize }\end{DoxyParamCaption})\hspace{0.3cm}{\ttfamily [static]}}

Called at program startup to override the default value for the haeder buffer \mbox{\Hypertarget{class_message_reader_a06ec9e561ff5cde8f4e1ffb0ff17cb1f}\label{class_message_reader_a06ec9e561ff5cde8f4e1ffb0ff17cb1f}} 
\index{Message\+Reader@{Message\+Reader}!current\+Message@{current\+Message}}
\index{current\+Message@{current\+Message}!Message\+Reader@{Message\+Reader}}
\subsubsection{\texorpdfstring{current\+Message()}{currentMessage()}}
{\footnotesize\ttfamily \hyperlink{class_message_interface}{Message\+Interface} $\ast$ Message\+Reader\+::current\+Message (\begin{DoxyParamCaption}{ }\end{DoxyParamCaption})\hspace{0.3cm}{\ttfamily [protected]}, {\ttfamily [virtual]}}

These methods are overridesa for virtual methods in Paser 

Implements \hyperlink{class_parser_a7b3c3ac1cf86a5f9fdda1ecf06dcd4dc}{Parser}.

\mbox{\Hypertarget{class_message_reader_ac480fcf3e6f5b1bb89b467d372a4e435}\label{class_message_reader_ac480fcf3e6f5b1bb89b467d372a4e435}} 
\index{Message\+Reader@{Message\+Reader}!get\+\_\+body\+\_\+chain@{get\+\_\+body\+\_\+chain}}
\index{get\+\_\+body\+\_\+chain@{get\+\_\+body\+\_\+chain}!Message\+Reader@{Message\+Reader}}
\subsubsection{\texorpdfstring{get\+\_\+body\+\_\+chain()}{get\_body\_chain()}}
{\footnotesize\ttfamily \hyperlink{class_buffer_chain}{Buffer\+Chain} Message\+Reader\+::get\+\_\+body\+\_\+chain (\begin{DoxyParamCaption}{ }\end{DoxyParamCaption})}

Gets the message body as a std\+::string !!! need to do better

accesses the \hyperlink{class_buffer_chain}{Buffer\+Chain} containing the de-\/chunked body data \mbox{\Hypertarget{class_message_reader_a93a38a06b77aea962b76fab6f9ba77e2}\label{class_message_reader_a93a38a06b77aea962b76fab6f9ba77e2}} 
\index{Message\+Reader@{Message\+Reader}!get\+\_\+raw\+\_\+body\+\_\+chain@{get\+\_\+raw\+\_\+body\+\_\+chain}}
\index{get\+\_\+raw\+\_\+body\+\_\+chain@{get\+\_\+raw\+\_\+body\+\_\+chain}!Message\+Reader@{Message\+Reader}}
\subsubsection{\texorpdfstring{get\+\_\+raw\+\_\+body\+\_\+chain()}{get\_raw\_body\_chain()}}
{\footnotesize\ttfamily \hyperlink{class_buffer_chain}{Buffer\+Chain} Message\+Reader\+::get\+\_\+raw\+\_\+body\+\_\+chain (\begin{DoxyParamCaption}{ }\end{DoxyParamCaption})}

accesses the \hyperlink{class_buffer_chain}{Buffer\+Chain} containing the raw (not de-\/chunked) body data \mbox{\Hypertarget{class_message_reader_a4f01917ce0c7c84159f81f797a7d13ec}\label{class_message_reader_a4f01917ce0c7c84159f81f797a7d13ec}} 
\index{Message\+Reader@{Message\+Reader}!On\+Body\+Data@{On\+Body\+Data}}
\index{On\+Body\+Data@{On\+Body\+Data}!Message\+Reader@{Message\+Reader}}
\subsubsection{\texorpdfstring{On\+Body\+Data()}{OnBodyData()}}
{\footnotesize\ttfamily void Message\+Reader\+::\+On\+Body\+Data (\begin{DoxyParamCaption}\item[{void $\ast$}]{buf,  }\item[{int}]{len }\end{DoxyParamCaption})\hspace{0.3cm}{\ttfamily [protected]}, {\ttfamily [virtual]}}

Overrides a \hyperlink{class_parser}{Parser} virtual method. Called whenever the http\+\_\+parser sees a piece of body data

This function is the only place where each piece of body data whether chunked or not is seen. Hence the only place to catch body data reliably. 

Reimplemented from \hyperlink{class_parser}{Parser}.

\mbox{\Hypertarget{class_message_reader_a813dbc29f75b43f36ef3f770cc39c3e7}\label{class_message_reader_a813dbc29f75b43f36ef3f770cc39c3e7}} 
\index{Message\+Reader@{Message\+Reader}!On\+Headers\+Complete@{On\+Headers\+Complete}}
\index{On\+Headers\+Complete@{On\+Headers\+Complete}!Message\+Reader@{Message\+Reader}}
\subsubsection{\texorpdfstring{On\+Headers\+Complete()}{OnHeadersComplete()}}
{\footnotesize\ttfamily void Message\+Reader\+::\+On\+Headers\+Complete (\begin{DoxyParamCaption}\item[{\hyperlink{class_message_interface}{Message\+Interface} $\ast$}]{msg,  }\item[{void $\ast$}]{body\+\_\+start\+\_\+ptr,  }\item[{std\+::size\+\_\+t}]{remainder }\end{DoxyParamCaption})\hspace{0.3cm}{\ttfamily [protected]}, {\ttfamily [virtual]}}

\begin{DoxyNote}{Note}
W\+A\+R\+N\+I\+NG -\/ http\+\_\+parser has been modified. The interface to this function and that of headers\+\_\+complete\+\_\+cb required by http\+\_\+parser have been modified (and that required a few lines of change in http\+\_\+parser) to provide the address in the current buffer of the first byte of body data in that same buffer, together with the length of the unparsed buffer at the time of headers complete. This is the only way of capturing a chunk header that happened to be in the same buffer as the last of the header data. If remander is N\+OT zero then some body data (maybe only chunk header) was in the buffer with the last of the header data. 
\end{DoxyNote}


Reimplemented from \hyperlink{class_parser}{Parser}.

\mbox{\Hypertarget{class_message_reader_a378b9c5f8136ac24865b5fac3c22694c}\label{class_message_reader_a378b9c5f8136ac24865b5fac3c22694c}} 
\index{Message\+Reader@{Message\+Reader}!parser\+\_\+ok@{parser\+\_\+ok}}
\index{parser\+\_\+ok@{parser\+\_\+ok}!Message\+Reader@{Message\+Reader}}
\subsubsection{\texorpdfstring{parser\+\_\+ok()}{parser\_ok()}}
{\footnotesize\ttfamily bool Message\+Reader\+::parser\+\_\+ok (\begin{DoxyParamCaption}\item[{int}]{nparsed,  }\item[{\hyperlink{struct_m_buffer}{M\+Buffer} \&}]{mb }\end{DoxyParamCaption})\hspace{0.3cm}{\ttfamily [protected]}}

if parser status is OK or if (http\+\_\+parser-\/$>$errno == H\+P\+E\+\_\+\+P\+A\+U\+S\+ED \&\& \hyperlink{class_parser_ad9d6c98af922409a78ff65083b1983e3}{is\+Finished\+Message()}) then we are OK with this message -\/ parsing is paused on E\+OM otherwise parser errors should be returned as errors\mbox{\Hypertarget{class_message_reader_a82f75653a713d3b947ff3dee82a34d1f}\label{class_message_reader_a82f75653a713d3b947ff3dee82a34d1f}} 
\index{Message\+Reader@{Message\+Reader}!post\+\_\+body\+\_\+chunk\+\_\+cb@{post\+\_\+body\+\_\+chunk\+\_\+cb}}
\index{post\+\_\+body\+\_\+chunk\+\_\+cb@{post\+\_\+body\+\_\+chunk\+\_\+cb}!Message\+Reader@{Message\+Reader}}
\subsubsection{\texorpdfstring{post\+\_\+body\+\_\+chunk\+\_\+cb()}{post\_body\_chunk\_cb()}}
{\footnotesize\ttfamily void Message\+Reader\+::post\+\_\+body\+\_\+chunk\+\_\+cb (\begin{DoxyParamCaption}\item[{Marvin\+::\+Error\+Type}]{er,  }\item[{\hyperlink{class_buffer_chain}{Buffer\+Chain}}]{chain }\end{DoxyParamCaption})\hspace{0.3cm}{\ttfamily [protected]}}

Schedules the execution of the \+\_\+read\+\_\+message\+\_\+cb in the future on this instances io\+\_\+service or runloop. \+\_\+read\+\_\+body\+\_\+cb is a property that stores the address of the callback provided to \hyperlink{class_message_reader_a811c0c6620e4bc7af99d5f519552846f}{read\+Body()}; \mbox{\Hypertarget{class_message_reader_a8df7f104650383e80e69a3d212b1e049}\label{class_message_reader_a8df7f104650383e80e69a3d212b1e049}} 
\index{Message\+Reader@{Message\+Reader}!post\+\_\+message\+\_\+cb@{post\+\_\+message\+\_\+cb}}
\index{post\+\_\+message\+\_\+cb@{post\+\_\+message\+\_\+cb}!Message\+Reader@{Message\+Reader}}
\subsubsection{\texorpdfstring{post\+\_\+message\+\_\+cb()}{post\_message\_cb()}}
{\footnotesize\ttfamily void Message\+Reader\+::post\+\_\+message\+\_\+cb (\begin{DoxyParamCaption}\item[{Marvin\+::\+Error\+Type}]{er }\end{DoxyParamCaption})\hspace{0.3cm}{\ttfamily [protected]}}

Schedules the execution of the \+\_\+read\+\_\+message\+\_\+cb in the future on this instances io\+\_\+service or runloop. \+\_\+read\+\_\+message\+\_\+cb is a property that stores the address of the callback provided to \hyperlink{class_message_reader_a16e0cec435a29862c95cdccf61b3099b}{read\+Message()} and \hyperlink{class_message_reader_ab63fcdf1b67d82ce259d1e82775149a5}{read\+Headers()} interface methods. \mbox{\Hypertarget{class_message_reader_a9109576c1fd18d70e9187744164c390c}\label{class_message_reader_a9109576c1fd18d70e9187744164c390c}} 
\index{Message\+Reader@{Message\+Reader}!read\+\_\+headers@{read\+\_\+headers}}
\index{read\+\_\+headers@{read\+\_\+headers}!Message\+Reader@{Message\+Reader}}
\subsubsection{\texorpdfstring{read\+\_\+headers()}{read\_headers()}}
{\footnotesize\ttfamily void Message\+Reader\+::read\+\_\+headers (\begin{DoxyParamCaption}\item[{std\+::function$<$ void(Marvin\+::\+Error\+Type err)$>$}]{cb }\end{DoxyParamCaption})\hspace{0.3cm}{\ttfamily [protected]}}

called by interface method read\+Headers to start the reading of headers without reading body data. Note the setting of \+\_\+reading\+\_\+full\+\_\+message = false \mbox{\Hypertarget{class_message_reader_a71a8b0ca7cc3aab28ee5fd9353f1b843}\label{class_message_reader_a71a8b0ca7cc3aab28ee5fd9353f1b843}} 
\index{Message\+Reader@{Message\+Reader}!read\+\_\+message@{read\+\_\+message}}
\index{read\+\_\+message@{read\+\_\+message}!Message\+Reader@{Message\+Reader}}
\subsubsection{\texorpdfstring{read\+\_\+message()}{read\_message()}}
{\footnotesize\ttfamily void Message\+Reader\+::read\+\_\+message (\begin{DoxyParamCaption}\item[{std\+::function$<$ void(Marvin\+::\+Error\+Type err)$>$}]{cb }\end{DoxyParamCaption})\hspace{0.3cm}{\ttfamily [protected]}}

Called interface method read\+Message to start the reading of headers and followed by the reading of all body data. Note the setting of \+\_\+reading\+\_\+full\+\_\+message = true \mbox{\Hypertarget{class_message_reader_a811c0c6620e4bc7af99d5f519552846f}\label{class_message_reader_a811c0c6620e4bc7af99d5f519552846f}} 
\index{Message\+Reader@{Message\+Reader}!read\+Body@{read\+Body}}
\index{read\+Body@{read\+Body}!Message\+Reader@{Message\+Reader}}
\subsubsection{\texorpdfstring{read\+Body()}{readBody()}}
{\footnotesize\ttfamily void Message\+Reader\+::read\+Body (\begin{DoxyParamCaption}\item[{std\+::function$<$ void(Marvin\+::\+Error\+Type err, \hyperlink{class_buffer_chain}{Buffer\+Chain} chunk)$>$}]{cb }\end{DoxyParamCaption})}

This methods read the body data. Should be called multiple times until the end of message body is signalled by the returned error code being equal to Marvin\+::make\+\_\+error\+\_\+eob() or or Marvin\+::make\+\_\+error\+\_\+eom()

The callback to read\+Body receives an error code and an instance (by value) of a \hyperlink{class_buffer_chain}{Buffer\+Chain} This is because the body data returned in that buffer is \char`\"{}de-\/chunked\char`\"{} and the buffer M\+AY contain multiple chunk bodies. It was done this way to prevent copying the body data to eliminate the chunk headers. the callback is responsible for handling the buffer and delete-\/ing it when appropriate

The \hyperlink{class_buffer_chain}{Buffer\+Chain} will release all the embedded buffers when the value goes out of scope.

An interface method that is called to initiate an async read of some body data. Result is returned via the callback \mbox{\Hypertarget{class_message_reader_ab63fcdf1b67d82ce259d1e82775149a5}\label{class_message_reader_ab63fcdf1b67d82ce259d1e82775149a5}} 
\index{Message\+Reader@{Message\+Reader}!read\+Headers@{read\+Headers}}
\index{read\+Headers@{read\+Headers}!Message\+Reader@{Message\+Reader}}
\subsubsection{\texorpdfstring{read\+Headers()}{readHeaders()}}
{\footnotesize\ttfamily void Message\+Reader\+::read\+Headers (\begin{DoxyParamCaption}\item[{std\+::function$<$ void(Marvin\+::\+Error\+Type err)$>$}]{cb }\end{DoxyParamCaption})}

N\+O\+TE \+: current implementation binds the message to the reader so a reader can only read one message and then needs to be discarded

Starts the reading process and invokes cb when all headers have been received Passes back an error code to indicate success/failure or maybe even E\+OM. The headers can be obtained from the the \hyperlink{class_message_reader}{Message\+Reader} object as it is an instance of \hyperlink{class_message_base}{Message\+Base}.

This method should only be called O\+N\+CE

An interface method called to initiate the reading of message first line and headers Completion signalled through the callback \mbox{\Hypertarget{class_message_reader_a16e0cec435a29862c95cdccf61b3099b}\label{class_message_reader_a16e0cec435a29862c95cdccf61b3099b}} 
\index{Message\+Reader@{Message\+Reader}!read\+Message@{read\+Message}}
\index{read\+Message@{read\+Message}!Message\+Reader@{Message\+Reader}}
\subsubsection{\texorpdfstring{read\+Message()}{readMessage()}}
{\footnotesize\ttfamily void Message\+Reader\+::read\+Message (\begin{DoxyParamCaption}\item[{std\+::function$<$ void(Marvin\+::\+Error\+Type err)$>$}]{cb }\end{DoxyParamCaption})}

This method starts the read of a full message including the body of the message. Use of this method requires the buffering of the full message body.

The message prefix (first line and headers) for the message can be obtained by remebering that a \hyperlink{class_message_reader}{Message\+Reader} is an instance of \hyperlink{class_message_base}{Message\+Base}.

The (de-\/chunked) body data can be obtained (as a \hyperlink{class_buffer_chain}{Buffer\+Chain}) by calling get\+\_\+body\+\_\+chain.

The raw not-\/de-\/chunked body data can be obtained (as a \hyperlink{class_buffer_chain}{Buffer\+Chain}) by calling get\+\_\+raw\+\_\+body\+\_\+chain

An interface method that is called to initiate the read of an entire message 

The documentation for this class was generated from the following files\+:\begin{DoxyCompactItemize}
\item 
marvin/message/message\+\_\+reader.\+hpp\item 
marvin/message/message\+\_\+reader.\+cpp\end{DoxyCompactItemize}
